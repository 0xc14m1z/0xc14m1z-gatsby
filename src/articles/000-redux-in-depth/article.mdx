---
position: 2
title: Redux In Depth
excerpt: The most comprehensive guide on how Redux works internally.
tags: ['javascript', 'inside', 'redux', 'react']
slug: redux-in-depth
isWorkInProgress: true
---

import Question from '../../components/Question'
import Link from '../../components/Link'
import Icon from '../../components/Icon'

Nella risoluzione di problemi la complessità della soluzione è, solitamente,
direttamente proporzionale a quella del problema.

La gestione dello stato interno di un'applicazione di grosse dimensioni è
qualcosa di molto complesso. Talmente complesso che anche per le migliori
applicazioni è una pratica abituale fare un refresh della pagina quando
non sembrano funzionare correttamente, o in ambiente desktop riavviarle.

In questi casi l'utente non fa altro che ripristinare, più o meno
inconsciamente, lo stato dell'applicazione a quello previsto come iniziale,
quello con cui l'applicazione sembra funzionare "per un po'", indicativamente
fino a che la gestione dello stato non diventa talmente complessa internamente
che qualcosa va storto di nuovo.

Redux è una di quelle tecnologie che propongono soluzioni semplici a problemi
come la gestione dello stato di un'intera applicazione.

È una libreria che ha avuto un impatto tale da cambiare letteralmente il modo di
sviluppare applicazioni e di gestirne lo stato, specialmente quando utilizzata
insieme a React. Nella mia quotidianità Redux è stato fondamentale per riuscire
a sviluppare in modo molto più efficiente applicazioni in cui lo stato interno
era **veramente** sotto controllo e ci si potesse concentrare sulla logica di
business.

Sono rimasto ancora più impressionato quando sono andato a studiarmi i sorgenti
di questa libreria così cruciale: un'API pubblica composta da 5 metodi e giusto
qualche decina di righe di codice, se si escludono i numerosi e ottimi commenti.

In questo articolo voglio descrivere il funzionamento di Redux e spiegare il
perché di alcuni comportamenti, prendendo in considerazione direttamente il
codice sorgente inizialmente sviluppato da Dan Abramov ed Andrew Clark e poi
curato insieme alla community.

Nel corso dell'articolo ci sono delle risposte ad alcune delle domande più
frequenti che mi sono fatto lavorando con Redux e altre che ho trovato online.
Per praticità, al termine dell'articolo c'è una piccola sezione FAQ.

## Table of contents

-  Who is this article for?
-  Redux, briefly
-  Store
-  Subscriptions
-  Actions
-  Reducer
-  Middlewares
-  Asynchronicity
-  Redux in React
-  Performance boost with selectors
-  FAQ

## 1. Who is this article for?

Questo è un contenuto di approfondimento in cui vengono analizzati nel
dettaglio **tutti** i comportamenti di Redux, anche quando utilizzato con React.

Cercherò di spiegare il funzionamento della libreria partendo da zero, per cui
anche chi non ha mai utilizzato Redux sarà in grado di seguire.

Fatte queste considerazioni, questo articolo non è per chi ha fretta di far
funzionare Redux su un progetto o per chi ha un problema specifico da risolvere
rapidamente.

## 2. Redux, briefly

Per prima cosa vediamo senza troppi dettagli l'utilizzo tipico di Redux.
Nei capitoli successivi ogni singolo concetto è descritto più nello specifico.

---

Redux è una libreria per la gestione dello stato globale di un'applicazione
Javascript, sia essa lato client o in Node, che implementa alcuni concetti e
meccanismi tipici del reactive programming.

---

Il reactive programming è un paradigma che prevede l'aggiornamento dei dati
mediante la propagazione dei cambiamenti. L'esempio più noto di applicazione di
questo concetto è il foglio di calcolo, tipo Excel.

Quando impostiamo in una cella una formula, stiamo creando una sorta di
"dipendenza" tra il valore della cella con la formula e i valori di tutte le
celle a cui la formula si riferisce.

```
+---+-----------------+-----------------+
|   |        A        |        B        |
+---+-----------------+-----------------+
| 1 | Net amount      |                 |
+---+-----------------+-----------------+
| 2 | Taxes           | = B1 * 0.1      |
+---+-----------------+-----------------+
```

Nella tabella qui sopra, il valore della cella `B2` è dipendente da quello della
cella `B1` a cui la formula si riferisce.

Nel momento in cui il foglio di calcolo rileva che il valore della cella `B1` è
cambiato, aggiorna a cascata anche il valore della cella `B2`.

```
+---+-----------------+-----------------+
|   |        A        |        B        |
+---+-----------------+-----------------+
| 1 | Net amount      | 100             |  ---+  propagazione
+---+-----------------+-----------------+     |  dei
| 2 | Taxes           | 10              |  <--+  cambiamenti
+---+-----------------+-----------------+
```

La catena di propagazione può anche essere più lunga, come nel caso qui sotto:

```
+---+-----------------+-----------------+
|   |        A        |        B        |
+---+-----------------+-----------------+
| 1 | Net amount      |                 |
+---+-----------------+-----------------+
| 2 | Taxes           | = B1 * 0.1      |
+---+-----------------+-----------------+
| 3 | TOTAL           | = B1 + B2       |
+---+-----------------+-----------------+
```

In questo esempio, il valore della cella `B3` dipenderà sia dal valore inserito
nella cella `B1` che dal valore propagato nella cella `B2`.

```
+---+-----------------+-----------------+
|   |        A        |        B        |
+---+-----------------+-----------------+
| 1 | Net amount      | 200             |  ---+
+---+-----------------+-----------------+     |
| 2 | Taxes           | 20              |  <--+ ---+
+---+-----------------+-----------------+          |
| 3 | TOTAL           | 220             |  <-------+
+---+-----------------+-----------------+
```

---

Ripartendo dagli esempi precedenti, Redux ricopre il ruolo del foglio di
calcolo.

Secondo uno dei 3 principi chiave di Redux, i dati dell'applicazione devono
essere gestiti in modo centralizzato, da un'unica entità che ne abbia il pieno
controllo. Gestendo tutte le informazioni di un progetto in un unico punto,
diventa molto più semplice fare debugging o persistere l'intera struttura su un
server o ripristinarla a seguito di un caricamento.

La struttura dati messa a disposizione da Redux per questo compito è lo
**Store**. Una delle caratterisiche dello store è che <mark>lo stato
dell'applicazione è reso disponibile in sola lettura</mark>. È quindi possibile
accedervi ed ispezionarlo, ma non modificarlo direttamente.

```
+---------------+
|     STORE     |
|               |
|  +---------+  |
|  |  STATO  |  |
|  |         |  |
|  |    ?    +----> lo stato è disponibile in lettura
|  +---------+  |
+---------------+
```

<Question>
  <Question.Title>
    Perché lo store espone le informazioni al suo interno in sola lettura?
  </Question.Title>

  Per essere in grado di rilevare le modifiche e propagare correttamente i
  cambiamenti, Redux impone delle restrizioni alle modalità in cui le
  informazioni possono essere modificate.

  <Question.Link to="#store">
    Un esempio dettagliato che descrive le conseguenze della modifica diretta
    dello stato è presente nella sezione relativa allo store.
  </Question.Link>

  <Question.Link to="#faq">
    Nelle FAQ invece è presente una risposta più sintetica.
  </Question.Link>

</Question>

Per alterare le informazioni contenute nello store è necessario comunicare
all'istanza una sorta di _segnale_ che indichi i dettagli della modifica che si
vuole applicare ai dati. Il termine ufficiale di questo segnale è **Action**.

```
+----------------+     +---------------+
|     ACTION     |     |     STORE     |
|                +---->|               |
|  cambiare X    |     |  +---------+  |
|  in Y          |     |  |  STATO  |  |
+----------------+     |  +---------+  |
                       +---------------+
```

La modifica vera e propria allo stato viene effettuata da una funzione che
va indicata in fase di creazione dello store. Le funzioni che hanno il compito
di interpretare una action e a determinare come modificare lo stato sono
chiamate **Reducer**.

```
                       +---------------------+
                       |     STORE           |
                       |                     |
                       |  +---------+        |
                       |  |  STATO  |        |
                       |  +----+----+        |
                       |       |             |
+----------------+     |  +----v----+        |
|     ACTION     +------->| REDUCER +---> ?  |
+----------------+     |  +---------+        |
                       +---------------------+
```

La particolarità dei reducer è che <mark>non modificano propriamente lo stato,
ma ne creano uno completamente nuovo</mark> a partire da quello precedente e
dalla action.

```
+----------------------------------+
|     STORE                        |
|                                  |
|  ///////////  +---------------+  |
|  ///////////  |  NUOVO STATO  |  |
|  ///////////  +---------------+  |
|                       ^          |
|  +---------+          |          |
|  | REDUCER +----------+          |
|  +---------+                     |
+----------------------------------+
```

<Question>
  <Question.Title>
    Perché un reducer deve produrre un nuovo stato e non modificare quello
    esistente?
  </Question.Title>

  <Question.Link to="#reducers">
    Un esempio dettagliato che descrive le conseguenze della modifica diretta
    dello stato è presente nella sezione relativa ai reducers.
  </Question.Link>
  <Question.Link to="#faq">
    Nelle FAQ invece è presente una risposta più sintetica.
  </Question.Link>
</Question>

Per consentire a Redux di propagare i cambiamenti di stato nella nostra
applicazione, per esempio per aggiornare l'interfaccia grafica o comunicare con
un server, è possibile aggiungere allo store dei callback che verranno eseguiti
quando una action viene segnalata e lo stato modificato. Il termine ufficiale
per identificare questo processo è **Subscription**.

---

## 3. Store

## 4. Subscriptions

## 5. Actions

## 6. Reducer

## 7. Middlewares

## 8. Asynchronicity

## 9. Redux in React

## 10. Performance boost with selectors

## 11. FAQ
